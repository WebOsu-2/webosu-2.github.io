define([],(function(){var e=function(){var e=playback.upcomingHits,o={x:playback.game.mouseX,y:playback.game.mouseY,time:1e3*playback.osu.audio.getPosition()},n=e.find(t(o));if(!n&&game.mouse){let t=game.mouse((new Date).getTime());t.time=o.time,n=e.find(a(t))}if(n&&("circle"==n.type||"slider"==n.type)){let e=50,t=o.time-n.time;Math.abs(t)<playback.GoodTime&&(e=100),Math.abs(t)<playback.GreatTime&&(e=300),playback.hitSuccess(n,e,o.time)}},t=function(e){return function(t){var a=e.x-t.x,o=e.y-t.y;return t.score<0&&a*a+o*o<playback.circleRadius*playback.circleRadius&&Math.abs(e.time-t.time)<playback.MehTime}},a=function(e){return function(t){var a=e.x-t.x,o=e.y-t.y,n=e.r+playback.circleRadius;let m=t.score<0&&a*a+o*o<n*n&&Math.abs(e.time-t.time)<playback.MehTime;return m&&console.log("grace hit"),m}};return Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),a=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var o=arguments[1],n=0;n<a;){var m=t[n];if(e.call(o,m,n,t))return m;n++}},configurable:!0,writable:!0}),function(t){t.auto={currentObject:null,curid:0,lastx:t.game.mouseX,lasty:t.game.mouseY,lasttime:0},t.autoplay?t.game.updatePlayerActions=function(a){const o=60;let n=t.auto.currentObject;if(t.game.down&&n)if("circle"==n.type||a>n.endTime)t.game.down=!1,t.auto.currentObject=null,t.auto.lasttime=a,t.auto.lastx=t.game.mouseX,t.auto.lasty=t.game.mouseY;else if("slider"==n.type)t.game.mouseX=n.ball.x||n.x,t.game.mouseY=n.ball.y||n.y;else{let e=Math.atan2(t.game.mouseY-n.y,t.game.mouseX-n.x);e+=.8,t.game.mouseY=n.y+o*Math.sin(e),t.game.mouseX=n.x+o*Math.cos(e)}n=t.auto.currentObject;for(;t.auto.curid<t.hits.length&&t.hits[t.auto.curid].time<a;)t.hits[t.auto.curid].score<0&&(t.game.mouseX=t.hits[t.auto.curid].x,t.game.mouseY=t.hits[t.auto.curid].y,"spinner"==t.hits[t.auto.curid].type&&(t.game.mouseY-=o),t.game.down=!0,e()),++t.auto.curid;!n&&t.auto.curid<t.hits.length&&(n=t.hits[t.auto.curid],t.auto.currentObject=n);if(!n||n.time>a+t.approachTime)return void(t.auto.lasttime=a);if(!t.game.down){let m=n.x,i=n.y;"spinner"==n.type&&(i-=o);let u=(a-t.auto.lasttime)/(n.time-t.auto.lasttime);u=Math.max(0,Math.min(1,u)),u=.5-Math.sin((Math.pow(1-u,1.5)-.5)*Math.PI)/2,t.game.mouseX=u*m+(1-u)*t.auto.lastx,t.game.mouseY=u*i+(1-u)*t.auto.lasty,a-n.time>-8&&(t.game.down=!0,e())}}:t.relax?t.game.updatePlayerActions=function(a){t.game.down=!0;let o=t.hits[t.auto.curid];if(!o)return;let n=o.judgements[o.judgements.length-1].finalTime;o.score<0?a>=n?t.auto.curid++:o.time<=a&&e():t.auto.curid++}:t.autopilot&&(t.game.updatePlayerActions=function(e){const a=60;let o=t.hits[t.auto.curid];if(!o)return;let n=o.judgements[o.judgements.length-1].finalTime;if(o.judgements[o.judgements.length-1].points<0)if(e>=n)t.auto.curid++,t.auto.lasttime=n,t.auto.lastx=t.game.mouseX,t.auto.lasty=t.game.mouseY;else if("circle"!=o.type&&e>o.time)if("slider"==o.type)t.game.mouseX=o.ball.x||o.x,t.game.mouseY=o.ball.y||o.y;else{let e=Math.atan2(t.game.mouseY-o.y,t.game.mouseX-o.x);e+=.8,t.game.mouseY=o.y+a*Math.sin(e),t.game.mouseX=o.x+a*Math.cos(e)}else{let n=o.x,m=o.y;"spinner"==o.type&&(m-=a);let i=(e-t.auto.lasttime)/Math.max(0,o.time-t.auto.lasttime);i=Math.max(0,Math.min(1,i)),i=.5-Math.sin((Math.pow(1-i,3)-.5)*Math.PI)/2,t.game.mouseX=i*n+(1-i)*t.auto.lastx,t.game.mouseY=i*m+(1-i)*t.auto.lasty}else t.auto.curid++,t.auto.lasttime=e,t.auto.lastx=t.game.mouseX,t.auto.lasty=t.game.mouseY});var a=[{x:256,y:192,t:(new Date).getTime()}];t.game.mouse=function(e){let t=a,o=0;for(;o<t.length-1&&t[0].t-t[o].t<40&&e-t[o].t<100;)o+=1;let n=0==o?{x:0,y:0}:{x:(t[0].x-t[o].x)/(t[0].t-t[o].t),y:(t[0].y-t[o].y)/(t[0].t-t[o].t)},m=Math.min(e-t[0].t+window.currentFrameInterval,40);return{x:t[0].x+n.x*m,y:t[0].y+n.y*m,r:Math.hypot(n.x,n.y)*Math.max(e-t[0].t,window.currentFrameInterval)}};var o=function(e){t.autopilot||(t.game.mouseX=(e.clientX-gfx.xoffset)/gfx.width*512,t.game.mouseY=(e.clientY-gfx.yoffset)/gfx.height*384,a.unshift({x:t.game.mouseX,y:t.game.mouseY,t:(new Date).getTime()}),a.length>10&&a.pop())},n=function(a){if(o(a),0==a.button){if(t.game.M1down)return;t.game.M1down=!0}else{if(2!=a.button)return;if(t.game.M2down)return;t.game.M2down=!0}a.preventDefault(),a.stopPropagation(),t.game.down=t.game.K1down||t.game.K2down||t.game.M1down||t.game.M2down,e()},m=function(e){if(o(e),0==e.button)t.game.M1down=!1;else{if(2!=e.button)return;t.game.M2down=!1}e.preventDefault(),e.stopPropagation(),t.game.down=t.game.K1down||t.game.K2down||t.game.M1down||t.game.M2down},i=function(e){if(e.touches&&e.touches[0]){var o=e.touches[0];t.game.mouseX=(o.clientX-gfx.xoffset)/gfx.width*512,t.game.mouseY=(o.clientY-gfx.yoffset)/gfx.height*384,a.unshift({x:t.game.mouseX,y:t.game.mouseY,t:(new Date).getTime()}),a.length>10&&a.pop()}},u=function(a){i(a),t.game.M1down||(t.game.M1down=!0,t.game.paused||t.ended||a.preventDefault(),t.game.down=t.game.K1down||t.game.K2down||t.game.M1down||t.game.M2down,e())},s=function(e){i(e),t.game.M1down=!1,t.game.paused||t.ended||e.preventDefault(),t.game.down=t.game.K1down||t.game.K2down||t.game.M1down||t.game.M2down},r=function(a){if(a.keyCode==t.game.K1keycode){if(t.game.K1down)return;t.game.K1down=!0}else{if(a.keyCode!=t.game.K2keycode)return;if(t.game.K2down)return;t.game.K2down=!0}a.preventDefault(),a.stopPropagation(),t.game.down=t.game.K1down||t.game.K2down||t.game.M1down||t.game.M2down,e()},g=function(e){if(e.keyCode==t.game.K1keycode)t.game.K1down=!1;else{if(e.keyCode!=t.game.K2keycode)return;t.game.K2down=!1}e.preventDefault(),e.stopPropagation(),t.game.down=t.game.K1down||t.game.K2down||t.game.M1down||t.game.M2down};t.autoplay||(t.game.window.addEventListener("mousemove",o),t.relax||(t.game.allowMouseButton&&(t.game.window.addEventListener("mousedown",n),t.game.window.addEventListener("mouseup",m),"ontouchstart"in window&&(t.game.window.addEventListener("touchstart",u),t.game.window.addEventListener("touchend",s))),t.game.window.addEventListener("keydown",r),t.game.window.addEventListener("keyup",g),"ontouchstart"in window&&t.game.window.addEventListener("touchmove",i))),t.game.cleanupPlayerActions=function(){t.game.window.removeEventListener("mousemove",o),t.game.window.removeEventListener("mousedown",n),t.game.window.removeEventListener("mouseup",m),t.game.window.removeEventListener("keydown",r),t.game.window.removeEventListener("keyup",g),t.game.window.removeEventListener("touchmove",i),t.game.window.removeEventListener("touchstart",u),t.game.window.removeEventListener("touchend",s)}}}));