function addbeatmap(e,t){var a=new BeatmapController;a.osu=new Osu(e.root),a.filename=e.filename,console.log("adding beatmap filename:",e.filename),a.osu.ondecoded=function(){if(a.osu.filterTracks(),a.osu.sortTracks(),a.osu.requestStar(),a.osuReady=!0,!_.some(a.osu.tracks,(function(e){return 0===e.general.Mode})))return void(pDragboxHint.innerText=pDragboxHint.modeErrHint);let e=a.createBeatmapBox();t(e),beatmapFileList.includes(a.filename)||(beatmapFileList.push(a.filename),localforage.setItem("beatmapfilelist",beatmapFileList,(function(e,t){e?console.error("Error while saving beatmap list"):console.log("local beatmap list set to",t)})))},a.osu.onerror=function(e){console.error("osu load error")},a.osu.load()}localforage.getItem("beatmapfilelist",(function(e,t){if(!e&&t&&void 0!==typeof t.length){t=t.filter((function(e){return e})),console.log("local beatmap list:",t),document.getElementById("bm-total-counter").innerText=t.length;var a=[];for(let e=0;e<t.length;++e){let e=document.createElement("div");e.className="beatmapbox",pBeatmapList.insertBefore(e,pDragbox),a.push(e)}var o=document.getElementById("bm-loaded-counter"),n=0;beatmapFileList=beatmapFileList.concat(t);for(let e=0;e<t.length;++e)localforage.getItem(t[e],(function(r,i){if(!r&&i){let r=new zip.fs.FS;r.filename=t[e],r.root.importBlob(i,(function(){addbeatmap(r,(function(t){pBeatmapList.replaceChild(t,a[e]),pDragboxHint.innerText=pDragboxHint.defaultHint})),o.innerText=++n}),(function(e){pDragboxHint.innerText=pDragboxHint.nonValidHint}))}else console.error("error while loading beatmap:",t[e],r)}))}else t?console.error("error while loading beatmap list:",e,t):console.log("no local beatmap list found.")})),BeatmapController.prototype.createBeatmapBox=function(){let e=this,t=document.createElement("div"),a=document.createElement("img"),o=document.createElement("div"),n=document.createElement("div"),r=document.createElement("div"),i=document.createElement("div");t.className="beatmapbox",a.className="beatmapcover",o.className="beatmapcover-overlay",n.className="beatmaptitle",r.className="beatmapauthor",i.className="beatmap-difficulties",t.appendChild(a),t.appendChild(o),t.appendChild(n),t.appendChild(r),t.appendChild(i);var l=e.osu.tracks[0].metadata.Title,m=e.osu.tracks[0].metadata.Artist,s=e.osu.tracks[0].metadata.Creator;if(n.innerText=l,r.innerText=m+" / "+s,a.alt="beatmap cover",e.osu.getCoverSrc(a),e.osu.tracks[0].length){let a=document.createElement("div");a.className="beatmaplength",t.appendChild(a);let o=e.osu.tracks[0].length;a.innerText=Math.floor(o/60)+":"+(o%60<10?"0":"")+o%60}return t.onclick=function(e){console.log("clcked"),createDifficultyList(t,e)},t};var pDragbox=document.getElementById("beatmap-dragbox"),pDragboxInner=document.getElementById("beatmap-dragbox-inner"),pDragboxHint=document.getElementById("beatmap-dragbox-hint"),pBeatmapList=document.getElementById("beatmap-list");pDragboxHint.defaultHint=window.i18n_dragdrophint||"Drag and drop a beatmap (.osz) file here",pDragboxHint.modeErrHint="Only supports osu! (std) mode beatmaps. Drop another file.",pDragboxHint.nonValidHint="Not a valid osz file. Drop another file.",pDragboxHint.noTransferHint="Not receiving any file. Please retry.",pDragboxHint.nonOszHint="Not an osz file. Drop another file.",pDragboxHint.loadingHint="loading...";var pGameArea=document.getElementById("game-area"),pMainPage=document.getElementById("main-page"),pNav=document.getElementById("main-nav"),beatmapFileList=[];