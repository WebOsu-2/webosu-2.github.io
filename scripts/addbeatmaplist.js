function starname(e){return"null"==typeof e||void 0===e?"unknown":e<2?"easy":e<2.7?"normal":e<4?"hard":e<5.3?"insane":e<6.5?"expert":"expert-plus"}function createStarRow(e){let t=document.createElement("div");t.className="star-row";for(let a=0;a<10;++a){let i=document.createElement("div");i.className="imgcontainer";let n=document.createElement("img");i.appendChild(n),t.appendChild(i),n.src="star.png";let d=Math.min(Math.max(e-a,0),1),l=5*(1-d),s="width:"+(8+10*d)+"px;";s+="bottom:"+l+"px;",s+="left:"+l+"px;",0==d&&(s+="opacity:0.4;"),n.setAttribute("style",s)}return t}function createDifficultyList(e,t){window.currentDifficultyList&&(window.removeEventListener("click",window.currentDifficultyList.clicklistener),window.currentDifficultyList.parentElement.removeChild(window.currentDifficultyList),window.currentDifficultyList=null),t.stopPropagation();let a=e.getBoundingClientRect(),i=t.clientX-a.left,n=t.clientY-a.top,d=document.createElement("div");window.currentDifficultyList=d,d.className="difficulty-box",d.style.left=i+"px",d.style.top=n+"px",e.appendChild(d);var l=function(){e.removeChild(d),window.currentDifficultyList=null,window.removeEventListener("click",l,!1)};window.addEventListener("click",l,!1),d.clicklistener=l;for(let t=0;t<e.data.length;++t){let a=document.createElement("div");a.className="difficulty-item",d.appendChild(a),a.data=e.data[t];let i=document.createElement("div"),n=document.createElement("div");i.className="bigringbase",n.className="bigring",n.classList.add(starname(e.data[t].star)),a.appendChild(i),a.appendChild(n);let l=document.createElement("div"),s=document.createElement("div"),o=document.createElement("div");l.className="versionline",s.className="version",o.className="mapper",l.appendChild(s),l.appendChild(o),a.appendChild(l),s.innerText=e.data[t].version,o.innerText="mapped by "+e.data[t].creator,a.appendChild(createStarRow(e.data[t].star)),a.onhover=function(){},a.onclick=function(e){window.scriptReady&&window.soundReady&&window.skinReady&&this.parentElement.parentElement.oszblob&&launchGame(this.parentElement.parentElement.oszblob,this.data.bid,this.data.version)}}d.onclick=function(e){e.stopPropagation()}}var NSaddBeatmapList={addlikeicon:function(e){let t=document.createElement("div");t.className="beatmaplike",t.setAttribute("hidden",""),e.appendChild(t),e.initlike=function(){window.liked_sid_set&&e.sid&&(window.liked_sid_set.has(e.sid)?(t.classList.add("icon-heart"),t.onclick=e.undolike):(t.classList.add("icon-heart-empty"),t.onclick=e.like),t.removeAttribute("hidden"))},e.like=function(a){a.stopPropagation(),window.liked_sid_set.add(e.sid),localforage.setItem("likedsidset",window.liked_sid_set,(function(e,a){e?console.error("Error saving liked beatmap list"):t.classList.add("hint-liked")})),t.onclick=e.undolike,t.classList.remove("icon-heart-empty"),t.classList.add("icon-heart")},e.undolike=function(a){a.stopPropagation(),window.liked_sid_set.delete(e.sid),localforage.setItem("likedsidset",window.liked_sid_set,(function(e,t){e&&console.error("Error saving liked beatmap list")})),t.onclick=e.like,t.classList.remove("icon-heart"),t.classList.add("icon-heart-empty"),t.classList.remove("hint-liked")},window.liked_sid_set?e.initlike():(window.liked_sid_set_callbacks||(window.liked_sid_set_callbacks=[]),window.liked_sid_set_callbacks.push(e.initlike))},addpreviewbox:function(e,t){let a=document.createElement("div");a.setdata=e,a.sid=e.sid;let i=document.createElement("img"),n=document.createElement("div"),d=document.createElement("div"),l=document.createElement("div"),s=document.createElement("div"),o=document.createElement("div");var c;return a.className="beatmapbox",i.className="beatmapcover",n.className="beatmapcover-overlay",d.className="beatmaptitle",l.className="beatmapartist",s.className="beatmapcreator",o.className="beatmapapproved",a.appendChild(i),a.appendChild(n),a.appendChild(d),a.appendChild(l),a.appendChild(s),a.appendChild(o),NSaddBeatmapList.addlikeicon(a),d.innerText=e.title,l.innerText=e.artist,s.innerText="mapped by "+e.creator,i.alt="cover"+e.sid,i.src="https://cdn.sayobot.cn:25225/beatmaps/"+e.sid+"/covers/cover.webp",o.innerText=4==(c=e.approved)?"LOVED":3==c?"QUALIFIED":2==c?"APPROVED":1==c?"RANKED":0==c?"PENDING":-1==c?"WIP":-2==c?"GRAVEYARD":"UNKNOWN",t&&t.appendChild(a),a},addStarRings:function(e,t){let a=[];for(let e=0;e<t.length;++e)a.push(t[e].star);let i=document.createElement("div");if(i.className="beatmap-difficulties",e.appendChild(i),a.length<=13)for(let e=0;e<a.length;++e){let t=document.createElement("div");t.className="difficulty-ring";let n=starname(a[e]);n.length>0&&t.classList.add(n),i.appendChild(t)}else{let e=document.createElement("div");e.className="difficulty-ring";let t=starname(a[a.length-1]);t.length>0&&e.classList.add(t),i.appendChild(e);let n=document.createElement("span");n.className="difficulty-count",n.innerText=a.length,i.appendChild(n)}if(0==t.length){let e=document.createElement("span");e.className="difficulty-count",e.innerText="no std map",i.appendChild(e)}},addLength:function(e,t){let a=0,i=0;for(let e=0;e<t.length;++e)a=Math.max(a,t[e].length),i=Math.max(i,t[e].BPM);let n=document.createElement("div");n.className="beatmaplength",e.appendChild(n),n.innerText=Math.floor(a/60)+":"+(a%60<10?"0":"")+a%60},addMoreInfo:function(e,t){t=(t=t.filter((function(e){return 0==e.mode}))).sort((function(e,t){return Math.sign(e.star-t.star)})),e.data=t,NSaddBeatmapList.addStarRings(e,t),NSaddBeatmapList.addLength(e,t)},requestMoreInfo:async function(e){const t="https://api.sayobot.cn/beatmapinfo?1="+e.sid;try{const a=await fetch(t),i=await a.json();NSaddBeatmapList.addMoreInfo(e,i.data)}catch(e){console.error("Error fetching additional info for beatmap:",e)}}};async function addBeatmapList(e,t,a,i){t||(t=document.getElementById("beatmap-list"));const n=await fetch(e),d=await n.json(),l=[];a&&d.data&&(d.data=d.data.filter(a)),i&&d.data&&(d.data=d.data.slice(0,i));for(let e=0;e<d.data.length;++e)l.push(NSaddBeatmapList.addpreviewbox(d.data[e],t));for(let e=0;e<d.data.length;++e)l[e].sid=d.data[e].sid,await NSaddBeatmapList.requestMoreInfo(l[e]),l[e].onclick=function(t){createDifficultyList(l[e],t),startdownload(l[e])};window.beatmaplistLoadedCallback&&(window.beatmaplistLoadedCallback(),window.beatmaplistLoadedCallback=null)}function addBeatmapSid(e,t){t||(t=document.getElementById("beatmap-list"));fetch("https://api.sayobot.cn/v2/beatmapinfo?0="+e).then((e=>e.json())).then((e=>{if(-1===e.status)return void alert("Beatmap not found with specified sid");const a=NSaddBeatmapList.addpreviewbox(e.data,t);a.sid=e.data.sid,NSaddBeatmapList.requestMoreInfo(a),a.onclick=function(e){createDifficultyList(a,e),startdownload(a)},window.beatmaplistLoadedCallback&&(window.beatmaplistLoadedCallback(),window.beatmaplistLoadedCallback=null)})).catch((e=>console.error(e)))}